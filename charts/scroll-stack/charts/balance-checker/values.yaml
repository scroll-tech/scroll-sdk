---
global:
  nameOverride: &app_name balance-checker
  fullnameOverride: *app_name

image:
  repository: scrolltech/balance-checker
  pullPolicy: Always
  tag: 0.0.2

env:
  - name: CONFIG_PATH
    value: "app/config/balance-checker-config.json"
  - name: BIND_PORT
    value: "8080"
  - name: METRICS_PORT
    value: "8090"
  - name: METRICS_URL
    value: 0.0.0.0
  - name: SLACK_NOTIFY_URL
    value: ""
  - name: SCROLL_L1_RPC
    value: "http://l1-devnet:8545/l1"
  - name: SCROLL_L2_RPC
    value: "http://l2-rpc:8545"

initContainers:
  wait-for-other-pod:
    image: curlimages/curl
    args:
      - /bin/sh
      - -c
      - >
        set -x;
        while [ $(curl -sw '%{http_code}' "l2-rpc:8545" -o /dev/null) -ne 200 ] && 
        [ $(curl -sw '%{http_code}' "l1-devnet:8545" -o /dev/null) -ne 404 ]; do
          sleep 5;
        done

resources:
  requests:
    memory: "100Mi"
    cpu: "50m"
  limits:
    memory: "500Mi"
    cpu: "100m"

persistence:
  *app_name:
    enabled: yes
    type: configMap
    mountPath: /app/config/
    name: balance-checker-config
  env:
    enabled: yes
    type: configMap
    mountPath: /config/
    name: balance-checker-env

service:
  main:
    enabled: true
    ports:
      http:
        enabled: true
        port: 80
      metrics:
        enabled: true
        port: 8090
        targetPort: 8090

defaultProbes: &default_probes
  enabled: true
  custom: true
  spec:
    httpGet:
      path: "/"
      port: 8090

probes:
  liveness:
    << : *default_probes
  readiness:
    << : *default_probes
  startup:
    << : *default_probes

serviceMonitor:
  main:
    enabled: true
    labels:
      release: scroll-stack
    serviceName: '{{ include "scroll.common.lib.chart.names.fullname" $ }}'
    endpoints:
      - port: metrics
        interval: 1m
        scrapeTimeout: 10s
