---
global:
  nameOverride: &app_name l2geth-bootnode
  fullnameOverride: *app_name

controller:
  replicas: 1
  strategy: RollingUpdate
  type: statefulset

image:
  repository: scrolltech/l2geth
  pullPolicy: Always
  tag: scroll-v5.2.0

env:
  - name: CHAIN_ID
    value: "222222"
  - name: L2GETH_ROLE
    value: bootnode
  - name: L2GETH_NODEKEY
    value: ""
  - name: L2GETH_PEER_LIST
    value: '["enode://848a7d59dd8f60dd1a51160e6bc15c194937855443de9be4b2abd83e11a5c4ac21d61d065448c5c520826fe83f1f29eb5a452daccca27b8113aa897074132507@l2geth-signer:30303"]'
  - name: L2GETH_L1_CONTRACT_DEPLOYMENT_BLOCK
    value: "0"
  - name: L2GETH_L1_ENDPOINT
    value: "http://l1-devnet:8545"
  - name: L2GETH_L1_WATCHER_CONFIRMATIONS
    value: "finalized"
  - name: L2GETH_P2P_PORT
    value: 30303
  - name: L2GETH_ENABLE_CCC
    value: false
  - name: L2GETH_CCC_RUST_LOG_LEVEL
    value: info
  - name: L2GETH_MAX_PEERS
    value: 500
  - name: VERBOSITY
    value: 3
  - name: CCC_FLAG
    value: "--ccc"
  - name: L2GETH_MIN_GAS_PRICE
    value: "1000000"
  - name: L2GETH_EXTRA_PARAMS
    value: ""

command: ["bash",
  "-c",
  "geth --datadir \"/l2geth/data\" init /l2geth/genesis/genesis.json && \
   echo \"[Node.P2P] StaticNodes = $L2GETH_PEER_LIST\" > \"/l2geth/config.toml\" && \
   geth --datadir \"/l2geth/data\" \
    --port \"$L2GETH_P2P_PORT\" --syncmode full --networkid \"$CHAIN_ID\" --maxpeers \"$L2GETH_MAX_PEERS\" --netrestrict \"$L2GETH_NETRESTRICT\" --nat \"$L2GETH_NAT\" \
    --bootnodes \"\" \
    --gcmode archive \
    --config \"/l2geth/config.toml\" \
    --cache.noprefetch \
    --verbosity 3 \
    --pprof --pprof.addr \"0.0.0.0\" --pprof.port 6060 \
    $CCC_FLAG \
    $METRICS_FLAGS \
    --txpool.globalqueue 4096 --txpool.globalslots 40960 --txpool.pricelimit \"$L2GETH_MIN_GAS_PRICE\" $LOCALS_FLAG \
    --l1.endpoint \"$L2GETH_L1_ENDPOINT\" --l1.confirmations \"$L2GETH_L1_WATCHER_CONFIRMATIONS\" --l1.sync.startblock \"$L2GETH_L1_CONTRACT_DEPLOYMENT_BLOCK\" \
    --miner.gasprice \"$L2GETH_MIN_GAS_PRICE\" --rpc.gascap 0 --gpo.ignoreprice \"$L2GETH_MIN_GAS_PRICE\" \ 
    --metrics --metrics.expensive \
    $L2GETH_EXTRA_PARAMS"
  ]

defaultProbes: &default_probes
  enabled: false
  custom: true
  spec:
    httpGet:
      path: "/"
      port: 8545

probes:
  liveness:
    << : *default_probes
  readiness:
    << : *default_probes
  startup:
    << : *default_probes

persistence:
  data:
    enabled: yes
    type: pvc
    mountPath: /l2geth/data
    accessMode: ReadWriteOnce
    size: 10Gi
  genesis:
    enabled: yes
    type: configMap
    mountPath: /l2geth/genesis/
    name: genesis-config

service:
  main:
    enabled: true
    ports:
      http:
        enabled: true
        port: 30303
      metrics:
        enabled: true
        port: 6060
        targetPort: 6060

serviceMonitor:
  main:
    enabled: true
    labels:
      release: scroll-stack
    serviceName: '{{ include "bjw-s.common.lib.chart.names.fullname" $ }}'
    endpoints:
      - port: metrics
        interval: 1m
        scrapeTimeout: 10s
        path: /debug/metrics/prometheus