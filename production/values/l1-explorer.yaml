envFrom:
  - configMapRef:
      name: l1-explorer-env
  - secretRef:
      name: l1-explorer-secret-env

initContainers:
  2-migrate-db:
    image: blockscout/blockscout:6.6.0
    command: [ "/bin/sh", "-c", "/app/bin/blockscout eval \"Elixir.Explorer.ReleaseTasks.create_and_migrate()\"" ]
    envFrom:
      - secretRef:
          name: l1-explorer-secret-env
  3-check-postgres-connection:
    image: atkrad/wait4x:latest
    args:
      - postgresql
      - $(DATABASE_URL)
      - --timeout
      - "0"
    envFrom:
      - secretRef:
          name: l1-explorer-secret-env

configMaps:
  env:
    enabled: true
    data:
      CHAIN_ID: "111111"
      ETHEREUM_JSONRPC_HTTP_URL: "http://l1-devnet:8545"
      ETHEREUM_JSONRPC_TRACE_URL: "http://l1-devnet:8545"
      ETHEREUM_JSONRPC_WS_URL: "ws://l1-devnet:8546"
      JSON_RPC: "http://l1-devnet:8545"

ingress:
  main:
    ingressClassName: "nginx"
    hosts:
      - host: l1-explorer-2.devnet.scroll.tech
        paths:
          - path: /
            pathType: Prefix

externalSecrets:
  l1-explorer-secret-env:
    data:
      - remoteRef:
          key: scroll/l1-explorer-env
          property: DATABASE_URL
        secretKey: DATABASE_URL
    refreshInterval: 2m
    serviceAccount: external-secrets
